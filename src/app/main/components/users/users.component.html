<button class="add-button" nz-button nzType="primary" (click)="showAddUserModal()">Add User</button>

<div class="search-bar">
  <input
    nz-input
    placeholder="Search by name, email, or role"
    [(ngModel)]="searchTerm"
    (ngModelChange)="onSearchChange($event)"
  />
</div>

<nz-table
  #usersTable
  nzShowSizeChanger
  nzShowSizeChangerPostfix="Page"
  nzBordered
  [nzData]="filteredUsers"
  (nzCurrentPageDataChange)="onCurrentPageDataChange($event)"
>
  <thead>
    <tr>
      <th>Name</th>
      <th>Email</th>
      <th>Role</th>
      <th nzWidth="120px" nzAlign="center">Action</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let data of usersOfCurrentPageData; trackBy: trackById">
      <ng-container *ngIf="!editCache[data._id]?.edit && !deleteCache[data._id]?.confirm">
        <td>{{ data.name }}</td>
        <td>{{ data.email }}</td>
        <td>{{ data.role }}</td>
        <td nzAlign="center">
          <button (click)="startEdit(data._id)" class="edit-button" nz-button nzType="primary">
            <span nz-icon nzType="edit" nzTheme="outline"></span>
          </button>
          <nz-divider nzType="vertical"></nz-divider>
          <button (click)="startDelete(data._id)" class="delete-button" nz-button nzType="primary">
            <span nz-icon nzType="delete" nzTheme="outline"></span>
          </button>
        </td>
      </ng-container>

      <ng-container *ngIf="editCache[data._id]?.edit">
        <td><input type="text" nz-input [(ngModel)]="editCache[data._id].data.name" /></td>
        <td><input type="text" nz-input [(ngModel)]="editCache[data._id].data.email" /></td>
        <td><input type="text" nz-input [(ngModel)]="editCache[data._id].data.role" /></td>
        <td nzAlign="center">
          <a (click)="saveEdit(data._id)" class="save">Save</a>
          <nz-divider nzType="vertical"></nz-divider>
          <a (click)="cancelEdit(data._id)">Cancel</a>
        </td>
      </ng-container>

      <ng-container *ngIf="deleteCache[data._id]?.confirm">
        <td colspan="4" nzAlign="center">
          <span>Are you sure you want to delete this user? <br/></span>
          <a (click)="deleteUser(data._id)" class="yes-link">Yes</a>
          <nz-divider nzType="vertical"></nz-divider>
          <a (click)="cancelDelete(data._id)" class="no-link">No</a>
        </td>
      </ng-container>
    </tr>
  </tbody>
</nz-table>

<app-add-user-modal #addUserModal (userAdded)="handleUserAdded($event)"></app-add-user-modal>
